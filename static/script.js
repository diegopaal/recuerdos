
const canvas=document.getElementById('particles');const ctx=canvas.getContext('2d');let W,H,dots=[];
function resize(){W=canvas.width=window.innerWidth;H=canvas.height=window.innerHeight;dots=Array.from({length:120},()=>({x:Math.random()*W,y:Math.random()*H,r:Math.random()*1.3+.5,vx:(Math.random()-.5)*.2,vy:(Math.random()-.5)*.2}))}
function loop(){ctx.clearRect(0,0,W,H);ctx.fillStyle='#9ef0ff';dots.forEach(d=>{d.x+=d.vx;d.y+=d.vy;if(d.x<0||d.x>W)d.vx*=-1;if(d.y<0||d.y>H)d.vy*=-1;ctx.globalAlpha=.4;ctx.beginPath();ctx.arc(d.x,d.y,d.r,0,Math.PI*2);ctx.fill()});requestAnimationFrame(loop)}
resize();loop();window.addEventListener('resize',resize);
document.getElementById('startBtn')?.addEventListener('click',()=>{document.getElementById('main').scrollIntoView({behavior:'smooth'})});
document.getElementById('giftMode')?.addEventListener('click',()=>{const b=document.createElement('div');b.style.position='fixed';b.style.inset='0';b.style.pointerEvents='none';document.body.appendChild(b);const colors=['#c9f0ff','#ffd6e7','#c9f36b'];for(let i=0;i<80;i++){const p=document.createElement('div');p.style.position='absolute';p.style.left=Math.random()*100+'%';p.style.top='-10px';p.style.width='6px';p.style.height='10px';p.style.background=colors[Math.floor(Math.random()*colors.length)];p.style.borderRadius='2px';b.appendChild(p);p.animate([{transform:`translateY(-10px) rotate(${Math.random()*90}deg)`},{transform:`translateY(120vh) rotate(${Math.random()*360}deg)`}],{duration:2200+Math.random()*2000,easing:'cubic-bezier(.2,.7,.2,1)'}).onfinish=()=>p.remove()}setTimeout(()=>b.remove(),2600)});
const io=new IntersectionObserver(es=>{es.forEach(e=>{if(e.isIntersecting){e.target.classList.add('inview');io.unobserve(e.target)}})},{threshold:.2});document.querySelectorAll('.section').forEach(s=>io.observe(s));
const toc=document.getElementById('toc');const sections=[...document.querySelectorAll('.section')];sections.forEach((s,i)=>{const b=document.createElement('button');b.title=s.dataset.title||`SecciÃ³n ${i+1}`;b.addEventListener('click',()=>s.scrollIntoView({behavior:'smooth'}));toc.appendChild(b)});
function onScroll(){let idx=0;const mid=window.innerHeight*.45;sections.forEach((s,i)=>{const r=s.getBoundingClientRect();if(r.top<mid)idx=i});[...toc.children].forEach((d,i)=>d.classList.toggle('active',i===idx))}document.addEventListener('scroll',onScroll);onScroll();
document.getElementById('downloadBtn')?.addEventListener('click',()=>{const blob=new Blob([document.documentElement.outerHTML],{type:'text/html'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='carta_interactiva_con_imagenes.html';document.body.appendChild(a);a.click();a.remove();URL.revokeObjectURL(url)});
